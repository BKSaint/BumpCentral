<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
        
        <link href="/static/styles.css" type="text/css"  rel="stylesheet">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <style>
        body {
            font-family: 'Montserrat', sans-serif;
        }
        
        </style>
        
    </head>

    <body style="background-image:url('/static/signup.jpg');">

       <div class="container text-center" style="max-width:100%; margin:0%">
            <div class="row align-items-start">
                <div class="col col-sm-2 bord black" style="padding-bottom: 100%;">
                    <a href="/feed" id="homelogo"><img alt="" class="navitems" src="/static/logomain.png">BumpCentral</a>
                </div>
            
                <div class="col col-md-5 divcenter" style="margin-top: 30px;">

                    {%if current_user.is_authenticated%}
                    <form style="border-bottom: 10px;" action="/post" method="POST" enctype="multipart/form-data">
                    <a href="/profile/{{current_user['username']}}"><img src="/media/users/{{current_user['pfp']}}" class="cropC" style="height:80px; width:80px; border: 1px solid white; margin-right: 5px; margin-bottom: 5px"></a><textarea style="vertical-align:middle;resize:none; color: white; background-color: black; margin: 5px;" rows="3" cols="30" name="caption" placeholder="Whats on your mind?"></textarea>
                    <br>
                    <input type="file" name="media">.<input type="submit"></form>
                    {%endif%}

                    {%if not current_user.is_authenticated%}
                    <div style="color:white; font-size:1.5rem;">Have something to share?<a href="/login"><button id="butn2">Log in</button></a><a href="/signup"><button id="butn2">Sign up</button></div></a>
                    {%endif%}

                    {% for post in posts%}
                    <div class="bord black" style="margin-top: 20px; border-radius: 12px;">
                        
                        {% if post['media'] != "" %}
                        <img style="height: 40%; width: 40%" src="/media/posts/{{post['media']}}">
                        {% endif %}
                        <p style="font-size: 20px"><b>{{post['username'] | escape }}</b> {{ post['caption'] | escape }}</p>
            
                        
                        {% if liked_posts['liked'] == 0 %}
                        <span onclick="likeButtonClicked()" id="likebutton"><img style="vertical-align: middle; height: 15px; width: 15px;" src="/static/unliked.png"></span>
                        {% endif %}
                        
                        {% if liked_posts['liked'] == 1 %}
                        <span onclick="likeButtonClicked()" id="likebutton"><img style="vertical-align: middle; height: 15px; width: 15px;" src="/static/liked.png"></span>
                        {% endif %}
                        {{post['likes']}}
                        <img style="vertical-align: middle; height: 15px; width: 15px;" src="/static/comm.png">
                        {{post['comments']}}
                        <script>
                        function likeButtonClicked() {
                            var post_id = {{post['id']}};
                            xhr.open("POST", "/like", true);
                            xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
                            xhr.onreadystatechange = function() {
                                if (xhr.readyState === 4 && xhr.status === 200) {
                                    var response = JSON.parse(xhr.responseText)
                                    var liked = response.liked;
                                        if liked == false:
                                            console.log("not liked")
                                }
                            };
                            xhr.send(JSON.stringify({post_id: post_id}))
                        }
                        </script>
                    </div>
                    {%endfor%}
                </div>
            </div>
        </div>
    </body>
</html>